import{u as H,e as Q,f as N,g as T,p as M,h as W,i as X,j as Y,r as F,k as Z,o as g,c as _,w as l,a as t,b as c,t as n,l as e,x as B,y as E,F as A,n as K,d as u,m as b,q as k,s as ee,v as te}from"./index-CZ-jeGgE.js";import{d as R,V as ae,b as C,e as j,f as L,g as G}from"./VGrid-CH5CbTjN.js";import{V as v}from"./VChip-g2OJaZBF.js";import{V as le,a as se,b as I}from"./VDataTableServer-DJDxiQR8.js";import{V as P,a as O,b as ie}from"./VTooltip-w28TotOc.js";import{V as f}from"./forwardRefs-DpN468t2.js";import{V as oe}from"./VRow-DoNlnVNA.js";import{V as $}from"./VTextField-DVzsUNSV.js";import{V as y}from"./VCol-CjVdm_MB.js";import{V as ne}from"./VForm-BoKOpqf4.js";import{V as h,a as de,b as V}from"./VList-Ek6lQ_m-.js";import{V as z}from"./VDivider-CQdL7re9.js";import{V as re}from"./VContainer-CikPPT_X.js";import"./VOverlay-BVQB-fyf.js";import"./scopeId-BoLFKdBO.js";const ue=H(),me=Q("user",{state:()=>({page:1,limit:10,total:0,items:[],index:-1,search:"",pages:[10,25,50,100],valid:!1,loading:!1,dialog:!1,dialogDetail:!1,dialogReset:!1,headers:()=>{const{t:r}=N(),m=[{title:r("text.fullNm"),key:"name",width:"10%"},{title:r("text.username"),key:"username",width:"10%"},{title:r("text.role"),key:"role_ids"},{title:r("text.status"),key:"data_status",width:"5%"},{title:r("text.updated_by"),key:"updated_by",width:"5%"},{title:r("text.updated_at"),key:"updated_at",width:"5%"}];return ue.hasPermissions(["user_update","user_delete"])&&m.push({title:r("text.actions"),key:"actions",width:"5%",align:"center",sortable:!1}),m},rules:()=>{const{t:r}=N();return{required:m=>!!m||r("rule.required"),min1:m=>!!m&&m.length>0||r("rule.required"),email:m=>!!m&&/.+@.+/.test(m)||r("rule.email")}},filter:{search:null,data_status:null,role_id:null},model:{user_id:"",username:"",name:"",phone:"",email:"",data_status:null,role_ids:[]},default:{user_id:"",username:"",name:"",phone:"",email:"",data_status:null,role_ids:[]}}),actions:{async fnSearch(){this.search=Math.random().toString()},async fnRoleSelect(){return T({url:"/cms/v1/users/roles"})},async fnList({page:r=1,itemsPerPage:m=10,sortBy:w=[]}){this.loading=!0;const a={page:r,limit:m,sorts:w.length?`${w[0].key}.${w[0].order}`:""};for(const p of Object.keys(this.filter))this.filter[p]&&(a[p]=this.filter[p]);const{data:{items:o,total:S}}=await T({url:"/cms/v1/users",params:a});this.items=o,this.total=S,this.loading=!1},async fnCancel(){this.index=-1,this.dialog=!1,this.dialogDetail=!1,this.dialogReset=!1,this.model=Object.assign({},this.default)},async fnDetailItem(r){this.dialogDetail=!0,this.model=Object.assign({},r),this.index=this.items.indexOf(r)},async fnEditItem(r){this.dialog=!0,this.model=Object.assign({},r),this.index=this.items.indexOf(r)},async fnResetItem(r){this.dialogReset=!0,this.model=Object.assign({},r),this.index=this.items.indexOf(r)},async fnSave(){if(this.loading=!0,this.valid){const{success:r,data:m}=this.index==-1?await M({url:"/cms/v1/users",body:this.model}):await W({url:`/cms/v1/users/${this.model.user_id}`,body:this.model});r&&(this.index==-1?this.items.unshift(m):this.items[this.index]=m,await this.fnCancel())}this.loading=!1},async fnReset(){this.loading=!0;const{success:r}=await M({url:`/cms/v1/users/${this.model.user_id}/reset-password`,body:{}});r&&await this.fnCancel(),this.loading=!1}}}),ce={class:"d-flex flex-row justify-center align-center ga-2 my-2"},fe={class:"font-weight-regular"},pe={class:"font-weight-regular"},ge={class:"font-weight-regular"},he={class:"font-weight-regular"},xe={class:"font-weight-regular"},_e={class:"font-weight-regular"},be={class:"text-primary"},Le={__name:"index",setup(r){const m=H(),w=X(),a=me(),{t:o}=N(),S=Y(),p=F([]),q=F([]);Z(async()=>{const{data_status:D}=await m.fnGetMeta();q.push(...D.map(s=>({id:s,name:o(`data_status.${s}`)})));const{data:{items:i}}=await a.fnRoleSelect();p.push(...i)});const U=D=>{switch(D){case"enable":return"text-green";case"disable":return"text-red"}};return(D,i)=>(g(),_(re,null,{default:l(()=>[t(v,{color:"primary",variant:"flat",class:"mb-4 px-5"},{default:l(()=>[t(R,{icon:"mdi-account-multiple",size:"20",start:"",class:"mb-0"}),c("h3",null,n(e(o)("sidebar.user")),1)]),_:1}),t(C,{class:"elevation-3 px-4"},{default:l(()=>[t(le,{"must-sort":"","items-per-page":e(a).limit,"onUpdate:itemsPerPage":i[22]||(i[22]=s=>e(a).limit=s),"items-per-page-options":e(a).pages,headers:e(a).headers(),items:e(a).items,"items-length":e(a).total,loading:e(a).loading,"show-current-page":"",search:e(a).search,"item-value":"user_id",density:"compact",class:"text-no-wrap","fixed-header":"","onUpdate:options":e(a).fnList},{"item.role_ids":l(({item:s})=>[(g(!0),B(A,null,E(s.role_ids.sort(),d=>(g(),_(v,{class:"mr-1",density:"compact"},{default:l(()=>{var x;return[u(n((x=p.find(J=>J.role_id==d))==null?void 0:x.name),1)]}),_:2},1024))),256))]),"item.data_status":l(({item:s})=>[t(v,{class:K(U(s.data_status)),label:"",density:"compact"},{default:l(()=>[u(n(e(o)(`data_status.${s.data_status}`)),1)]),_:2},1032,["class"])]),"item.updated_at":l(({item:s})=>[u(n(e(S).format(s.updated_at,"fullDate")),1)]),"item.actions":l(({item:s})=>[c("div",ce,[t(P,{text:e(o)("action.detail")},{activator:l(({props:d})=>[e(m).hasPermissions(["user_view"])?(g(),_(f,b({key:0},d,{color:"teal",icon:"mdi-eye",size:"x-small",rounded:"0",onClick:x=>e(a).fnDetailItem(s)}),null,16,["onClick"])):k("",!0)]),_:2},1032,["text"]),t(P,{text:e(o)("action.edit")},{activator:l(({props:d})=>[e(m).hasPermissions(["user_update"])?(g(),_(f,b({key:0},d,{color:"warning",icon:"mdi-square-edit-outline",size:"x-small",rounded:"0",onClick:x=>e(a).fnEditItem(s)}),null,16,["onClick"])):k("",!0)]),_:2},1032,["text"]),t(P,{text:e(o)("action.delete")},{activator:l(({props:d})=>[e(m).hasPermissions(["user_delete"])?(g(),_(f,b({key:0},d,{color:"red",icon:"mdi-trash-can-outline",size:"x-small",rounded:"0",onClick:x=>e(a).fnDelItem(s)}),null,16,["onClick"])):k("",!0)]),_:2},1032,["text"]),t(P,{text:e(o)("action.reset")+" "+e(o)("text.password")},{activator:l(({props:d})=>[e(m).hasPermissions(["user_update"])?(g(),_(f,b({key:0},d,{color:"red",icon:"mdi-lock-reset",size:"x-small",rounded:"0",onClick:x=>e(a).fnResetItem(s)}),null,16,["onClick"])):k("",!0)]),_:2},1032,["text"])])]),top:l(()=>[t(O,{modelValue:e(a).dialog,"onUpdate:modelValue":i[16]||(i[16]=s=>e(a).dialog=s),"max-width":"500",transition:"false",persistent:"",scrollable:"","no-click-animation":""},{activator:l(({props:s})=>[t(oe,{class:"justify-space-between ga-2 my-4 mx-0"},{default:l(()=>[t(ae,{"max-width":"350"},{default:l(()=>[t($,{modelValue:e(a).filter.search,"onUpdate:modelValue":i[0]||(i[0]=d=>e(a).filter.search=d),density:"compact",variant:"outlined",color:"primary",placeholder:e(o)("text.search_user"),"append-inner-icon":"mdi-magnify",clearable:"","hide-details":"",onKeyup:i[1]||(i[1]=ee(d=>e(a).fnSearch(),["enter"]))},null,8,["modelValue","placeholder"])]),_:1}),e(w).mobile.value?k("",!0):(g(),_(ie,{key:0})),t(se,{"close-on-content-click":!1},{activator:l(({props:d})=>[t(f,b({color:"brown-lighten-2",height:"38"},d),{default:l(()=>[t(R,{start:""},{default:l(()=>[u("mdi-tune")]),_:1}),u(" "+n(e(o)("text.filter")),1)]),_:2},1040)]),default:l(()=>[t(C,{"min-width":"350"},{default:l(()=>[t(j,{class:"pb-0"},{default:l(()=>[t(y,{cols:"12",class:"pa-1"},{default:l(()=>[t(I,{modelValue:e(a).filter.role_id,"onUpdate:modelValue":[i[2]||(i[2]=d=>e(a).filter.role_id=d),i[3]||(i[3]=d=>e(a).fnSearch())],density:"compact",variant:"outlined",color:"primary",prefix:e(o)("text.role")+":","item-title":"name","item-value":"role_id",items:[{role_id:null,name:e(o)("text.all")},...p],"hide-selected":""},null,8,["modelValue","prefix","items"])]),_:1}),t(y,{cols:"12",class:"pa-1"},{default:l(()=>[t(I,{modelValue:e(a).filter.data_status,"onUpdate:modelValue":[i[4]||(i[4]=d=>e(a).filter.data_status=d),i[5]||(i[5]=d=>e(a).fnSearch())],density:"compact",variant:"outlined",color:"primary",prefix:e(o)("text.status")+":","item-title":"name","item-value":"id",items:[{id:null,name:e(o)("text.all")},...q],"hide-selected":""},null,8,["modelValue","prefix","items"])]),_:1})]),_:1})]),_:1})]),_:2},1024),t(f,{color:"success",height:"38",onClick:i[6]||(i[6]=d=>e(a).fnList())},{default:l(()=>[t(R,{start:""},{default:l(()=>[u("mdi-refresh")]),_:1}),u(" "+n(e(o)("action.refresh")),1)]),_:1}),t(f,b({color:"primary",height:"38"},s),{default:l(()=>[t(R,{start:""},{default:l(()=>[u("mdi-plus-thick")]),_:1}),u(" "+n(e(o)("action.create")),1)]),_:2},1040)]),_:2},1024)]),default:l(()=>[t(ne,{modelValue:e(a).valid,"onUpdate:modelValue":i[14]||(i[14]=s=>e(a).valid=s),onSubmit:i[15]||(i[15]=te(s=>e(a).fnSave(),["prevent","stop"]))},{default:l(()=>[t(C,null,{default:l(()=>[t(L,{class:"d-flex justify-space-between align-center font-weight-bold bg-primary pl-7"},{default:l(()=>[c("span",null,n(e(a).index==-1?e(o)("action.create"):e(o)("action.update"))+" "+n(e(o)("sidebar.user")),1),t(f,{icon:"mdi-close",variant:"text",loading:e(a).loading,onClick:i[7]||(i[7]=s=>e(a).fnCancel())},null,8,["loading"])]),_:1}),t(j,{class:"pb-0"},{default:l(()=>[t(y,{cols:"12",class:"pa-1"},{default:l(()=>[t($,{modelValue:e(a).model.name,"onUpdate:modelValue":i[8]||(i[8]=s=>e(a).model.name=s),density:"compact",variant:"outlined",color:"primary",label:e(o)("text.fullNm"),rules:[e(a).rules().required]},null,8,["modelValue","label","rules"])]),_:1}),t(y,{cols:"12",class:"pa-1"},{default:l(()=>[t($,{modelValue:e(a).model.username,"onUpdate:modelValue":i[9]||(i[9]=s=>e(a).model.username=s),density:"compact",variant:"outlined",color:"primary",label:e(o)("text.username"),rules:[e(a).rules().required]},null,8,["modelValue","label","rules"])]),_:1}),t(y,{cols:"12",class:"pa-1"},{default:l(()=>[t($,{modelValue:e(a).model.phone,"onUpdate:modelValue":i[10]||(i[10]=s=>e(a).model.phone=s),density:"compact",variant:"outlined",color:"primary",label:e(o)("text.phone"),rules:[e(a).rules().required]},null,8,["modelValue","label","rules"])]),_:1}),t(y,{cols:"12",class:"pa-1"},{default:l(()=>[t($,{modelValue:e(a).model.email,"onUpdate:modelValue":i[11]||(i[11]=s=>e(a).model.email=s),density:"compact",variant:"outlined",color:"primary",label:e(o)("text.email"),rules:[e(a).rules().email]},null,8,["modelValue","label","rules"])]),_:1}),t(y,{cols:"12",class:"pa-1"},{default:l(()=>[t(I,{modelValue:e(a).model.data_status,"onUpdate:modelValue":i[12]||(i[12]=s=>e(a).model.data_status=s),density:"compact",variant:"outlined",color:"primary",label:e(o)("text.status"),rules:[e(a).rules().required],items:q,chips:"","item-title":"name","item-value":"id","hide-selected":""},{chip:l(({props:s,item:d})=>[t(v,b(s,{class:U(d.value),text:d.title}),null,16,["class","text"])]),item:l(({props:s,item:d})=>[t(h,b(s,{class:U(d.value),title:d.title}),null,16,["class","title"])]),_:1},8,["modelValue","label","rules","items"])]),_:1}),t(y,{cols:"12",class:"pa-1"},{default:l(()=>[t(I,{modelValue:e(a).model.role_ids,"onUpdate:modelValue":i[13]||(i[13]=s=>e(a).model.role_ids=s),density:"compact",variant:"outlined",color:"primary",label:e(o)("text.role")+` (${e(a).model.role_ids.length}/${p.length})`,rules:[e(a).rules().min1],items:p,"hide-selected":"",multiple:"",clearable:"",chips:"","closable-chips":"","item-title":"name","item-value":"role_id"},null,8,["modelValue","label","rules","items"])]),_:1})]),_:1}),t(z),t(G,{class:"mx-5"},{default:l(()=>[t(f,{color:"primary",variant:"flat",type:"submit",loading:e(a).loading},{default:l(()=>[u(n(e(a).index==-1?e(o)("action.create"):e(o)("action.update")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),t(O,{modelValue:e(a).dialogDetail,"onUpdate:modelValue":i[18]||(i[18]=s=>e(a).dialogDetail=s),"max-width":"500",transition:"false",persistent:"",scrollable:"","no-click-animation":""},{default:l(()=>[t(C,null,{default:l(()=>[t(L,{class:"d-flex justify-space-between align-center font-weight-bold bg-primary pl-7"},{default:l(()=>[c("span",null,n(e(o)("action.detail"))+" "+n(e(o)("sidebar.user")),1),t(f,{icon:"mdi-close",variant:"text",loading:e(a).loading,onClick:i[17]||(i[17]=s=>e(a).fnCancel())},null,8,["loading"])]),_:1}),t(j,{class:"font-weight-bold py-2"},{default:l(()=>[t(de,{density:"compact"},{default:l(()=>[t(h,{class:"px-1 my-2 bg-background"},{default:l(()=>[t(V,{class:"font-weight-bold"},{default:l(()=>[u(n(e(o)("text.name")),1)]),_:1}),c("span",fe,n(e(a).model.name),1)]),_:1}),t(h,{class:"px-1 my-2 bg-background"},{default:l(()=>[t(V,{class:"font-weight-bold"},{default:l(()=>[u(n(e(o)("text.username")),1)]),_:1}),c("span",pe,n(e(a).model.username),1)]),_:1}),t(h,{class:"px-1 my-2 bg-background"},{default:l(()=>[t(V,{class:"font-weight-bold"},{default:l(()=>[u(n(e(o)("text.phone")),1)]),_:1}),c("span",ge,n(e(a).model.phone),1)]),_:1}),t(h,{class:"px-1 my-2 bg-background"},{default:l(()=>[t(V,{class:"font-weight-bold"},{default:l(()=>[u(n(e(o)("text.email")),1)]),_:1}),c("span",he,n(e(a).model.email),1)]),_:1}),t(h,{class:"px-1 my-2 bg-background"},{default:l(()=>[t(V,{class:"font-weight-bold"},{default:l(()=>[u(n(e(o)("text.role")),1)]),_:1}),(g(!0),B(A,null,E(e(a).model.role_ids.sort(),s=>(g(),_(v,{class:"mr-1",density:"compact"},{default:l(()=>{var d;return[u(n((d=p.find(x=>x.role_id==s))==null?void 0:d.name),1)]}),_:2},1024))),256))]),_:1}),t(h,{class:"px-1 my-2 bg-background"},{default:l(()=>[t(V,{class:"font-weight-bold"},{default:l(()=>[u(n(e(o)("text.status")),1)]),_:1}),t(v,{class:K(U(e(a).model.data_status)),label:"",density:"compact"},{default:l(()=>[u(n(e(o)(`data_status.${e(a).model.data_status}`)),1)]),_:1},8,["class"])]),_:1}),t(h,{class:"px-1 my-2 bg-background"},{default:l(()=>[t(V,{class:"font-weight-bold"},{default:l(()=>[u(n(e(o)("text.updated_by")),1)]),_:1}),c("span",xe,n(e(a).model.updated_by),1)]),_:1}),t(h,{class:"px-1 my-2 bg-background"},{default:l(()=>[t(V,{class:"font-weight-bold"},{default:l(()=>[u(n(e(o)("text.updated_at")),1)]),_:1}),c("span",_e,n(e(S).format(e(a).model.updated_at,"fullDate")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:e(a).dialogReset,"onUpdate:modelValue":i[21]||(i[21]=s=>e(a).dialogReset=s),"max-width":"500",transition:"false",persistent:"",scrollable:"","no-click-animation":""},{default:l(()=>[t(C,null,{default:l(()=>[t(L,{class:"d-flex justify-space-between align-center font-weight-bold bg-primary pl-7"},{default:l(()=>[c("span",null,n(e(o)("action.reset"))+" "+n(e(o)("text.password")),1),t(f,{icon:"mdi-close",variant:"text",loading:e(a).loading,onClick:i[19]||(i[19]=s=>e(a).fnCancel())},null,8,["loading"])]),_:1}),t(j,{class:"font-weight-bold px-7 pb-5"},{default:l(()=>[u(n(e(o)("text.reset"))+" ",1),c("span",be,n(e(a).model.name),1)]),_:1}),t(z),t(G,{class:"mx-5"},{default:l(()=>[t(f,{color:"red",variant:"flat",loading:e(a).loading,onClick:i[20]||(i[20]=s=>e(a).fnReset())},{default:l(()=>[u(n(e(o)("action.reset")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(z)]),_:2},1032,["items-per-page","items-per-page-options","headers","items","items-length","loading","search","onUpdate:options"])]),_:1})]),_:1}))}};export{Le as default};
