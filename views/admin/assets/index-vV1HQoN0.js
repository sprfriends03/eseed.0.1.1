import{u as B,e as E,f as L,g as R,p as A,h as K,i as G,j as H,r as O,k as J,o as f,c as x,w as a,a as t,b as g,t as d,l as e,n as T,d as m,m as h,q as C,s as Q,v as W,x as X,y as Y,F as Z}from"./index-CZ-jeGgE.js";import{d as $,V as ee,b as D,e as j,f as z,g as te}from"./VGrid-CH5CbTjN.js";import{V as y}from"./VChip-g2OJaZBF.js";import{V as ae,a as se,b as P}from"./VDataTableServer-DJDxiQR8.js";import{V as I,a as M,b as le}from"./VTooltip-w28TotOc.js";import{V as c}from"./forwardRefs-DpN468t2.js";import{V as ie}from"./VRow-DoNlnVNA.js";import{V as F}from"./VTextField-DVzsUNSV.js";import{V as S}from"./VCol-CjVdm_MB.js";import{V as oe}from"./VForm-BoKOpqf4.js";import{V as _,a as ne,b as V}from"./VList-Ek6lQ_m-.js";import{V as N}from"./VDivider-CQdL7re9.js";import{V as de}from"./VContainer-CikPPT_X.js";import"./VOverlay-BVQB-fyf.js";import"./scopeId-BoLFKdBO.js";const re=B(),ue=E("role",{state:()=>({page:1,limit:10,total:0,items:[],index:-1,search:"",pages:[10,25,50,100],valid:!1,loading:!1,dialog:!1,dialogDetail:!1,headers:()=>{const{t:r}=L(),u=[{title:r("text.name"),key:"name"},{title:r("text.status"),key:"data_status",width:"5%"},{title:r("text.updated_by"),key:"updated_by",width:"5%"},{title:r("text.updated_at"),key:"updated_at",width:"5%"}];return re.hasPermissions(["role_update","role_delete"])&&u.push({title:r("text.actions"),key:"actions",width:"5%",align:"center",sortable:!1}),u},rules:()=>{const{t:r}=L();return{required:u=>!!u||r("rule.required"),min1:u=>!!u&&u.length>0||r("rule.required")}},filter:{search:null,data_status:null},model:{role_id:"",name:"",data_status:null,permissions:[]},default:{role_id:"",name:"",data_status:null,permissions:[]}}),actions:{async fnSearch(){this.search=Math.random().toString()},async fnList({page:r=1,itemsPerPage:u=10,sortBy:b=[]}){this.loading=!0;const s={page:r,limit:u,sorts:b.length?`${b[0].key}.${b[0].order}`:""};for(const p of Object.keys(this.filter))this.filter[p]&&(s[p]=this.filter[p]);const{data:{items:o,total:v}}=await R({url:"/cms/v1/roles",params:s});this.items=o,this.total=v,this.loading=!1},async fnCancel(){this.index=-1,this.dialog=!1,this.dialogDetail=!1,this.model=Object.assign({},this.default)},async fnDetailItem(r){this.dialogDetail=!0,this.model=Object.assign({},r),this.index=this.items.indexOf(r)},async fnEditItem(r){this.dialog=!0,this.model=Object.assign({},r),this.index=this.items.indexOf(r)},async fnSave(){if(this.loading=!0,this.valid){const{success:r,data:u}=this.index==-1?await A({url:"/cms/v1/roles",body:this.model}):await K({url:`/cms/v1/roles/${this.model.role_id}`,body:this.model});r&&(this.index==-1?this.items.unshift(u):this.items[this.index]=u,await this.fnCancel())}this.loading=!1}}}),me={class:"d-flex flex-row justify-center align-center ga-2 my-2"},ce={class:"font-weight-regular"},pe={class:"font-weight-regular"},fe={class:"font-weight-regular"},je={__name:"index",setup(r){const u=B(),b=G(),s=ue(),{t:o}=L(),v=H(),p=O([]),U=O([]);J(async()=>{const{data_status:k,permission:i}=await u.fnGetMeta();p.push(...k.map(l=>({id:l,name:o(`data_status.${l}`)}))),i.sort((l,n)=>l.localeCompare(n)),U.push(...i.map(l=>({id:l,name:o(`permission.${l}`)})))});const w=k=>{switch(k){case"enable":return"text-green";case"disable":return"text-red"}};return(k,i)=>(f(),x(de,null,{default:a(()=>[t(y,{color:"primary",variant:"flat",class:"mb-4 px-5"},{default:a(()=>[t($,{icon:"mdi-security",size:"20",start:"",class:"mb-0"}),g("h3",null,d(e(o)("sidebar.role")),1)]),_:1}),t(D,{class:"elevation-3 px-4"},{default:a(()=>[t(ae,{"must-sort":"","items-per-page":e(s).limit,"onUpdate:itemsPerPage":i[14]||(i[14]=l=>e(s).limit=l),"items-per-page-options":e(s).pages,headers:e(s).headers(),items:e(s).items,"items-length":e(s).total,loading:e(s).loading,"show-current-page":"",search:e(s).search,"item-value":"role_id",density:"compact",class:"text-no-wrap","fixed-header":"","onUpdate:options":e(s).fnList},{"item.data_status":a(({item:l})=>[t(y,{class:T(w(l.data_status)),label:"",density:"compact"},{default:a(()=>[m(d(e(o)(`data_status.${l.data_status}`)),1)]),_:2},1032,["class"])]),"item.updated_at":a(({item:l})=>[m(d(e(v).format(l.updated_at,"fullDate")),1)]),"item.actions":a(({item:l})=>[g("div",me,[t(I,{text:e(o)("action.detail")},{activator:a(({props:n})=>[e(u).hasPermissions(["role_view"])?(f(),x(c,h({key:0},n,{color:"teal",icon:"mdi-eye",size:"x-small",rounded:"0",onClick:q=>e(s).fnDetailItem(l)}),null,16,["onClick"])):C("",!0)]),_:2},1032,["text"]),t(I,{text:e(o)("action.edit")},{activator:a(({props:n})=>[e(u).hasPermissions(["role_update"])?(f(),x(c,h({key:0},n,{color:"warning",icon:"mdi-square-edit-outline",size:"x-small",rounded:"0",onClick:q=>e(s).fnEditItem(l)}),null,16,["onClick"])):C("",!0)]),_:2},1032,["text"]),t(I,{text:e(o)("action.delete")},{activator:a(({props:n})=>[e(u).hasPermissions(["role_delete"])?(f(),x(c,h({key:0},n,{color:"red",icon:"mdi-trash-can-outline",size:"x-small",rounded:"0",onClick:q=>e(s).fnDelItem(l)}),null,16,["onClick"])):C("",!0)]),_:2},1032,["text"])])]),top:a(()=>[t(M,{modelValue:e(s).dialog,"onUpdate:modelValue":i[11]||(i[11]=l=>e(s).dialog=l),"max-width":"500",transition:"false",persistent:"",scrollable:"","no-click-animation":""},{activator:a(({props:l})=>[t(ie,{class:"justify-space-between ga-2 my-4 mx-0"},{default:a(()=>[t(ee,{"max-width":"350"},{default:a(()=>[t(F,{modelValue:e(s).filter.search,"onUpdate:modelValue":i[0]||(i[0]=n=>e(s).filter.search=n),density:"compact",variant:"outlined",color:"primary",placeholder:e(o)("text.search_name"),"append-inner-icon":"mdi-magnify",clearable:"","hide-details":"","single-line":"",onKeyup:i[1]||(i[1]=Q(n=>e(s).fnSearch(),["enter"]))},null,8,["modelValue","placeholder"])]),_:1}),e(b).mobile.value?C("",!0):(f(),x(le,{key:0})),t(se,{"close-on-content-click":!1},{activator:a(({props:n})=>[t(c,h({color:"brown-lighten-2",height:"38"},n),{default:a(()=>[t($,{start:""},{default:a(()=>[m("mdi-tune")]),_:1}),m(" "+d(e(o)("text.filter")),1)]),_:2},1040)]),default:a(()=>[t(D,{"min-width":"350"},{default:a(()=>[t(j,{class:"pb-0"},{default:a(()=>[t(S,{cols:"12",class:"pa-1"},{default:a(()=>[t(P,{modelValue:e(s).filter.data_status,"onUpdate:modelValue":[i[2]||(i[2]=n=>e(s).filter.data_status=n),i[3]||(i[3]=n=>e(s).fnSearch())],density:"compact",variant:"outlined",color:"primary",prefix:e(o)("text.status")+":","item-title":"name","item-value":"id",items:[{id:null,name:e(o)("text.all")},...p],"hide-selected":""},null,8,["modelValue","prefix","items"])]),_:1})]),_:1})]),_:1})]),_:2},1024),t(c,{color:"success",height:"38",onClick:i[4]||(i[4]=n=>e(s).fnList())},{default:a(()=>[t($,{start:""},{default:a(()=>[m("mdi-refresh")]),_:1}),m(" "+d(e(o)("action.refresh")),1)]),_:1}),t(c,h({color:"primary",height:"38"},l),{default:a(()=>[t($,{start:""},{default:a(()=>[m("mdi-plus-thick")]),_:1}),m(" "+d(e(o)("action.create")),1)]),_:2},1040)]),_:2},1024)]),default:a(()=>[t(oe,{modelValue:e(s).valid,"onUpdate:modelValue":i[9]||(i[9]=l=>e(s).valid=l),onSubmit:i[10]||(i[10]=W(l=>e(s).fnSave(),["prevent","stop"]))},{default:a(()=>[t(D,null,{default:a(()=>[t(z,{class:"d-flex justify-space-between align-center font-weight-bold bg-primary pl-7"},{default:a(()=>[g("span",null,d(e(s).index==-1?e(o)("action.create"):e(o)("action.update"))+" "+d(e(o)("sidebar.role")),1),t(c,{icon:"mdi-close",variant:"text",loading:e(s).loading,onClick:i[5]||(i[5]=l=>e(s).fnCancel())},null,8,["loading"])]),_:1}),t(j,{class:"pb-0"},{default:a(()=>[t(S,{cols:"12",class:"pa-1"},{default:a(()=>[t(F,{modelValue:e(s).model.name,"onUpdate:modelValue":i[6]||(i[6]=l=>e(s).model.name=l),density:"compact",variant:"outlined",color:"primary",label:e(o)("text.name"),rules:[e(s).rules().required]},null,8,["modelValue","label","rules"])]),_:1}),t(S,{cols:"12",class:"pa-1"},{default:a(()=>[t(P,{modelValue:e(s).model.data_status,"onUpdate:modelValue":i[7]||(i[7]=l=>e(s).model.data_status=l),density:"compact",variant:"outlined",color:"primary",label:e(o)("text.status"),rules:[e(s).rules().required],items:p,chips:"","item-title":"name","item-value":"id","hide-selected":""},{chip:a(({props:l,item:n})=>[t(y,h(l,{class:w(n.value),text:n.title}),null,16,["class","text"])]),item:a(({props:l,item:n})=>[t(_,h(l,{class:w(n.value),title:n.title}),null,16,["class","title"])]),_:1},8,["modelValue","label","rules","items"])]),_:1}),t(S,{cols:"12",class:"pa-1"},{default:a(()=>[t(P,{modelValue:e(s).model.permissions,"onUpdate:modelValue":i[8]||(i[8]=l=>e(s).model.permissions=l),density:"compact",variant:"outlined",color:"primary",label:e(o)("text.permission")+` (${e(s).model.permissions.length}/${U.length})`,rules:[e(s).rules().min1],items:U,"item-title":"name","item-value":"id","hide-selected":"",chips:"",multiple:"",clearable:"","closable-chips":""},null,8,["modelValue","label","rules","items"])]),_:1})]),_:1}),t(N),t(te,{class:"mx-5"},{default:a(()=>[t(c,{color:"primary",variant:"flat",type:"submit",loading:e(s).loading},{default:a(()=>[m(d(e(s).index==-1?e(o)("action.create"):e(o)("action.update")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),t(M,{modelValue:e(s).dialogDetail,"onUpdate:modelValue":i[13]||(i[13]=l=>e(s).dialogDetail=l),"max-width":"500",transition:"false",persistent:"",scrollable:"","no-click-animation":""},{default:a(()=>[t(D,null,{default:a(()=>[t(z,{class:"d-flex justify-space-between align-center font-weight-bold bg-primary pl-7"},{default:a(()=>[g("span",null,d(e(o)("action.detail"))+" "+d(e(o)("sidebar.role")),1),t(c,{icon:"mdi-close",variant:"text",loading:e(s).loading,onClick:i[12]||(i[12]=l=>e(s).fnCancel())},null,8,["loading"])]),_:1}),t(j,{class:"font-weight-bold py-2"},{default:a(()=>[t(ne,{density:"compact"},{default:a(()=>[t(_,{class:"px-1 my-2 bg-background"},{default:a(()=>[t(V,{class:"font-weight-bold"},{default:a(()=>[m(d(e(o)("text.name")),1)]),_:1}),g("span",ce,d(e(s).model.name),1)]),_:1}),t(_,{class:"px-1 my-2 bg-background"},{default:a(()=>[t(V,{class:"font-weight-bold"},{default:a(()=>[m(d(e(o)("text.permission")),1)]),_:1}),(f(!0),X(Z,null,Y(e(s).model.permissions.sort(),l=>(f(),x(y,{class:"mr-1",density:"compact"},{default:a(()=>[m(d(e(o)(`permission.${l}`)),1)]),_:2},1024))),256))]),_:1}),t(_,{class:"px-1 my-2 bg-background"},{default:a(()=>[t(V,{class:"font-weight-bold"},{default:a(()=>[m(d(e(o)("text.status")),1)]),_:1}),t(y,{class:T(w(e(s).model.data_status)),label:"",density:"compact"},{default:a(()=>[m(d(e(o)(`data_status.${e(s).model.data_status}`)),1)]),_:1},8,["class"])]),_:1}),t(_,{class:"px-1 my-2 bg-background"},{default:a(()=>[t(V,{class:"font-weight-bold"},{default:a(()=>[m(d(e(o)("text.updated_by")),1)]),_:1}),g("span",pe,d(e(s).model.updated_by),1)]),_:1}),t(_,{class:"px-1 my-2 bg-background"},{default:a(()=>[t(V,{class:"font-weight-bold"},{default:a(()=>[m(d(e(o)("text.updated_at")),1)]),_:1}),g("span",fe,d(e(v).format(e(s).model.updated_at,"fullDate")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N)]),_:2},1032,["items-per-page","items-per-page-options","headers","items","items-length","loading","search","onUpdate:options"])]),_:1})]),_:1}))}};export{je as default};
